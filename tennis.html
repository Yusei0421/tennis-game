<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #1a1a2e;
            font-family: 'Courier New', monospace;
        }
        .game-container {
            text-align: center;
        }
        h1 {
            color: #eee;
            margin-bottom: 10px;
        }
        canvas {
            border: 4px solid #4a4a6a;
            border-radius: 4px;
        }
        .instructions {
            color: #888;
            margin-top: 15px;
            font-size: 14px;
        }
        .score-display {
            color: #eee;
            font-size: 24px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>TENNIS - 壁打ち</h1>
        <div class="score-display">
            スコア: <span id="player-score">0</span>
        </div>
        <canvas id="game" width="800" height="500"></canvas>
        <p class="instructions">W/S または ↑/↓ キーで操作 | スペースキーで開始/リセット</p>
    </div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameRunning = false;
        let playerScore = 0;

        // Paddle settings
        const paddleWidth = 12;
        const paddleHeight = 80;
        const paddleSpeed = 7;

        // Ball settings
        const ballSize = 12;
        let ballSpeedX = 5;
        let ballSpeedY = 5;

        // Player paddle
        const player = {
            x: 30,
            y: canvas.height / 2 - paddleHeight / 2,
            width: paddleWidth,
            height: paddleHeight,
            dy: 0
        };

        // Ball
        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            size: ballSize,
            dx: ballSpeedX,
            dy: ballSpeedY
        };

        // Key states
        const keys = {
            w: false,
            s: false,
            ArrowUp: false,
            ArrowDown: false
        };

        // Event listeners
        document.addEventListener('keydown', (e) => {
            if (e.key in keys) {
                keys[e.key] = true;
                e.preventDefault();
            }
            if (e.key === ' ') {
                if (!gameRunning) {
                    playerScore = 0;
                    updateScore();
                    resetBall();
                    gameRunning = true;
                }
                e.preventDefault();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key in keys) {
                keys[e.key] = false;
            }
        });

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.dx = ballSpeedX; // Always start towards the wall
            ball.dy = ballSpeedY * (Math.random() > 0.5 ? 1 : -1);
        }

        function updateScore() {
            document.getElementById('player-score').textContent = playerScore;
        }

        function drawRect(x, y, w, h, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, w, h);
        }

        function drawBall(x, y, size, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, size / 2, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawNet() {
            ctx.setLineDash([10, 10]);
            ctx.strokeStyle = '#4a4a6a';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function draw() {
            // Clear canvas
            drawRect(0, 0, canvas.width, canvas.height, '#16213e');

            // Draw paddle
            drawRect(player.x, player.y, player.width, player.height, '#00d9ff');

            // Draw wall (right side)
            drawRect(canvas.width - 15, 0, 15, canvas.height, '#ff6b6b');

            // Draw ball
            drawBall(ball.x, ball.y, ball.size, '#fff');

            // Draw start message if game not running
            if (!gameRunning) {
                ctx.fillStyle = '#fff';
                ctx.font = '24px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('Press SPACE to start', canvas.width / 2, canvas.height / 2 + 60);
            }
        }

        function movePlayer() {
            if (keys.w || keys.ArrowUp) {
                player.y -= paddleSpeed;
            }
            if (keys.s || keys.ArrowDown) {
                player.y += paddleSpeed;
            }

            // Keep paddle in bounds
            if (player.y < 0) player.y = 0;
            if (player.y + player.height > canvas.height) {
                player.y = canvas.height - player.height;
            }
        }

        function moveBall() {
            if (!gameRunning) return;

            ball.x += ball.dx;
            ball.y += ball.dy;

            // Top and bottom collision
            if (ball.y - ball.size / 2 < 0 || ball.y + ball.size / 2 > canvas.height) {
                ball.dy *= -1;
            }

            // Player paddle collision
            if (ball.x - ball.size / 2 < player.x + player.width &&
                ball.x + ball.size / 2 > player.x &&
                ball.y > player.y &&
                ball.y < player.y + player.height) {
                ball.dx = Math.abs(ball.dx) * 1.05;
                ball.dy *= 1.02;

                // Add angle based on where ball hits paddle
                const hitPos = (ball.y - player.y) / player.height;
                ball.dy = (hitPos - 0.5) * 10;
            }

            // Right wall collision (score point)
            if (ball.x + ball.size / 2 > canvas.width - 15) {
                ball.dx = -Math.abs(ball.dx) * 1.05;
                ball.dy *= 1.02;
                playerScore++;
                updateScore();
            }

            // Left side miss (game over)
            if (ball.x < 0) {
                gameRunning = false;
            }

            // Limit ball speed
            const maxSpeed = 15;
            ball.dx = Math.max(-maxSpeed, Math.min(maxSpeed, ball.dx));
            ball.dy = Math.max(-maxSpeed, Math.min(maxSpeed, ball.dy));
        }

        function gameLoop() {
            movePlayer();
            moveBall();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Start the game loop
        gameLoop();
    </script>
</body>
</html>
